-- Copy ALL of this and paste into psql
-- This creates all your tables

CREATE TABLE IF NOT EXISTS brands (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL UNIQUE,
  handle VARCHAR(255),
  notes TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS campaigns (
  id SERIAL PRIMARY KEY,
  brand_id INTEGER NOT NULL,
  name VARCHAR(255) NOT NULL,
  objective VARCHAR(50) NOT NULL,
  daily_budget NUMERIC(10, 2),
  locations TEXT,
  languages VARCHAR(50) DEFAULT 'es,*',
  age_range VARCHAR(20) DEFAULT '18-44',
  gender VARCHAR(20) DEFAULT 'ALL',
  optimization VARCHAR(50),
  bidding VARCHAR(50),
  status VARCHAR(50) DEFAULT 'DRAFT',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (brand_id) REFERENCES brands(id)
);

CREATE TABLE IF NOT EXISTS ad_groups (
  id SERIAL PRIMARY KEY,
  campaign_id INTEGER NOT NULL,
  name VARCHAR(255),
  interests TEXT,
  behaviors TEXT,
  hashtags TEXT,
  placements VARCHAR(50) DEFAULT 'AUTO',
  connection VARCHAR(50) DEFAULT 'ANY',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (campaign_id) REFERENCES campaigns(id)
);

CREATE TABLE IF NOT EXISTS ads (
  id SERIAL PRIMARY KEY,
  ad_group_id INTEGER NOT NULL,
  name VARCHAR(255),
  primary_text TEXT,
  cta VARCHAR(100) DEFAULT 'Order Now',
  duration_sec INTEGER DEFAULT 15,
  music_hint TEXT,
  asset_url TEXT,
  status VARCHAR(50) DEFAULT 'DRAFT',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (ad_group_id) REFERENCES ad_groups(id)
);

CREATE TABLE IF NOT EXISTS generations (
  id SERIAL PRIMARY KEY,
  brand_id INTEGER NOT NULL,
  input_payload JSONB,
  output_payload JSONB,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (brand_id) REFERENCES brands(id)
);

-- Add indexes
CREATE INDEX IF NOT EXISTS idx_campaigns_brand_id ON campaigns(brand_id);
CREATE INDEX IF NOT EXISTS idx_ad_groups_campaign_id ON ad_groups(campaign_id);
CREATE INDEX IF NOT EXISTS idx_ads_ad_group_id ON ads(ad_group_id);
CREATE INDEX IF NOT EXISTS idx_generations_brand_id ON generations(brand_id);

-- Insert seed brands
INSERT INTO brands (name, handle, notes) 
VALUES 
  ('Chiltepik', '@chiltepik', 'Mariscos premium, aguachiles, ceviches'),
  ('ChocoBites', '@chocobites', 'Galletas artesanales, dulces, chewy')
ON CONFLICT (name) DO NOTHING;

